---
import Default from '@astrojs/starlight/components/PageTitle.astro'
import type { Props } from '@astrojs/starlight/props'

const { entry } = Astro.props
const { category, lastChanged, contributors } = entry?.data ?? {}

function timeAgo(dateStr: string): string {
  const diff = Date.now() - new Date(dateStr).getTime()
  const days = Math.floor(diff / 86400000)
  if (days < 7) return `${days}d ago`
  if (days < 30) return `${Math.floor(days / 7)}w ago`
  return `${Math.floor(days / 30)}mo ago`
}
---

{(category || lastChanged) && (
  <div class="fn-meta">
    {category && <span class="category-badge">{category}</span>}
    {lastChanged && <span class="last-changed">{timeAgo(lastChanged)}</span>}
    {contributors && contributors.length > 0 && (
      <span class="contributors">{contributors.length} contributor{contributors.length > 1 ? 's' : ''}</span>
    )}
  </div>
)}
<Default {...Astro.props} />

<style>
  .fn-meta {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    flex-wrap: wrap;
  }
  .category-badge {
    font-size: 0.75rem;
    padding: 0.125rem 0.5rem;
    border-radius: 999px;
    background: var(--sl-color-accent-low);
    color: var(--sl-color-accent-high);
  }
  .last-changed, .contributors {
    font-size: 0.75rem;
    color: var(--sl-color-gray-3);
  }
</style>
